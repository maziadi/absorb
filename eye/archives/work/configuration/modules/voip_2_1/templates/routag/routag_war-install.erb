#!/bin/bash

pkg_version="<%= routag_war_version -%>"
pkg_name="routag-${pkg_version}.war" 
target_directory=/opt/mobicents/standalone/deployments/
target_user=jboss-as

error() {
  echo "ERROR: $1"
  exit -1
}

set -e

cd /tmp
wget -c http://gold.alphalink.fr/misc/routag/${pkg_name} || error "Unable to download"
mv ${pkg_name} ${target_directory}routag.war
chown -R ${target_user}:adm ${target_directory}
touch /etc/routag_war-installed-${pkg_version} || error "Unable to create flag file"
