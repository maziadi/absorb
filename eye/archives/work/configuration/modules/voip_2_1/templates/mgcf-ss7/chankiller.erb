#!/bin/sh
# Script coupant les coms d'une duree superieure a timelimit
app=/usr/sbin/asterisk
timelimit=<%= ss7_session_timeout %>


[ -x $app ] || exit 1

list=`$app -rnx 'core show channels concise' | awk 'BEGIN{FS="!"} /^SIP|^DAHDI/ { if ($12 > timelimit && NR % 2) print $1 }' timelimit=$timelimit`
for chan in $list
do
  $app -rnx "channel request hangup $chan" | logger
done

