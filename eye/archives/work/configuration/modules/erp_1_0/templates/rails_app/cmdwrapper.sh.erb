#!/bin/sh
# wrapper.sh -u user -c command

if ! [ `id -u` = 0 ]; then
  echo "Not root. Skipping."
  exit 1
fi

usage () {
  echo "usage: $0 -u username -c command [-h]"
}

while getopts ":hu:c:" option; do
  case "$option" in
    u) user="$OPTARG";;
    c) command="$OPTARG";;
    h) usage
       exit 0
       ;;
    :) echo "Error: did you not forget an argument ?"
       usage
       exit 1
       ;;
    ?) echo "Error: unknown option."
       usage
       exit 1
       ;;
  esac
done

if [ -z "$user" ]; then
  echo "Error: you must specify a username using -u"
  usage
  exit 1
fi

if [ -z "$command" ]; then
  echo "Error: you must specify a command using -c"
  usage
  exit 1
fi

dir="/var/run/$user"
mkdir -p $dir 2>&1 >/dev/null
chown -R $user:$user $dir 2>&1 >/dev/null

/bin/su - $user -c "$command"
