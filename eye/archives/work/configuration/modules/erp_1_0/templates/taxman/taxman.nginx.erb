server {

  listen   80; ## listen for ipv4
  listen   [::]:80 default ipv6only=on; ## listen for ipv6

  server_name <%= hostname %>;
  access_log /var/log/nginx/localhost.access.log;

  location /data/vno_journals {
<% allowing_hosts.each do |allowing_host| -%>
    allow <%= allowing_host %>;
<% end -%>
    deny all;
    rewrite /data/(.*) /$1;
    root /data;
    expires 30d;
    access_log off;
    break;
  }
  location /data/csv_reports {
<% allowing_hosts.each do |allowing_host| -%>
    allow <%= allowing_host %>;
<% end -%>
    deny all;
    rewrite /data/(.*) /$1;
    root /data;
    expires 30d;
    access_log off;
    break;
  }
  location / {
    deny all;
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-FORWARDED_PROTO http;
    proxy_redirect off;
    if (-f $request_filename/index.html) {
      rewrite (.*) $1/index.html break;
    }
    if (-f $request_filename.html) {
      rewrite (.*) $1.html break;
    }
  }
}
