Scenario: nominal, e164, destination nationale geographique
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: nominal, e164, destination internationale
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 49123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 49123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/49123456789
	Then dial channel SIP/NSG with nadi 4, number 49123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/49123456789 
	Then done

Scenario: nominal, e164, destination nationale 08
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33823456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33823456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/823456789
	Then dial channel SIP/NSG with nadi 3, number 823456789-g=FT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/823456789 
	Then done

Scenario: nominal, e164, destination nationale numero court 1014
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 0151014 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 0151014 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/1014
	Then dial channel SIP/NSG with nadi 115, number 1014-g=FT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/1014
	Then done

Scenario: nominal, e164, destination nationale numero court 3631
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 0153631 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 0153631 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/3631
	Then dial channel SIP/NSG with nadi 115, number 3631-g=FT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/3631
	Then done

Scenario: nominal, e164, destination nationale numero court 118218
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 015118218 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 015118218 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/118218
	Then dial channel SIP/NSG with nadi 115, number 118218-g=FT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/118218
	Then done

Scenario: compte locked
	Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: true
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then hangup with cause 31
	Given answered time 0
	Then complete cdr abcdef1234567890/480_LimitReached/0/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: limites atteintes
	Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
	Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, max_calls: 2, call_count: 2
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then hangup with cause 31
	Given answered time 0
	Then complete cdr abcdef1234567890/480_LimitReached/0/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: emergency
	Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within emergency
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: emergency, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
  Then done

Scenario: emergency et compte locked
	Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within emergency
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: emergency, locked: true
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
  Then done

Scenario: emergency et limites atteintes
	Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within emergency
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
	Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: emergency, max_calls: 2, call_count: 2
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/emergency - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
  Then done

Scenario: nominal, e164, privacy given
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Anonymous <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: id
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 1
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 1
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/Anonymous -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/Anonymous -- e/0990000000002/123456789 
	Then done

Scenario: nominal, e164, porta sortante
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 returning 10684
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 10684123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: generic number different de identity number
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000001> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000001
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000001/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000001/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: anonymat
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: id
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 1
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 1
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/RESTRICTED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/000000000/000000000/RESTRICTED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: pas de generic number
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Anonymous <anonymous> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/000000000/ALLOWED/Anonymous -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/000000000/ALLOWED/Anonymous -- e/0990000000002/123456789 
	Then done

Scenario: privacy et pas de generic number
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Anonymous <anonymous> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: id
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 1
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/000000000/RESTRICTED/Anonymous -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/000000000/RESTRICTED/Anonymous -- e/0990000000002/123456789 
	Then done

Scenario: GN numero court vers un numero national
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+333232> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 3232
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/3232/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/3232/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done

Scenario: GN numero court vers un numero international
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+333232> to 216123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 216123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 3232
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/3232/000000000/ALLOWED/Jean Bon -- e/0990000000002/216123456789
	Then dial channel SIP/NSG with nadi 4, number 216123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/3232/000000000/ALLOWED/Jean Bon -- e/0990000000002/216123456789 
	Then done

Scenario: Appel d'un numero international vers un numero national
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+216000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+216111111111>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 216111111111
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 4
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 216000000000
	Then add header X-FreeTDM-GN-NADI: 4
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/216000000000/216111111111/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/216000000000/216111111111/ALLOWED/Jean Bon -- e/0990000000002/123456789 
	Then done


Scenario: Appel d'un numero international vers un numero special
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+216000000000> to 0153232 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+216111111111>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 0153232 and find nothing
	Then set callerIdNum to 216111111111
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 4
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 216000000000
	Then add header X-FreeTDM-GN-NADI: 4
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/216000000000/216111111111/ALLOWED/Jean Bon -- e/0990000000002/3232
	Then dial channel SIP/NSG with nadi 115, number 3232-g=FT and options 121
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/216000000000/216111111111/ALLOWED/Jean Bon -- e/0990000000002/3232
	Then done

Scenario: NSG unreachable
  Given ss7.Ss7OutboundAgi and inbound_timeout: 120, outbound_timeout: 121, ft_chan: FT, op_chan: ORT, nsg_chan: SIP/NSG, gw_chan: SIP/GW
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
  Given header P-Asserted-Identity: <tel:+33000000000>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mgcf-10.sip.openvno.net
	Given icid abcdef1234567890
	Given header Privacy: <null>
	Then query NPDB by 33123456789 and find nothing
	Then set callerIdNum to 000000000
  Then query EXDB with 0990000000002 returning out_plan: e164, in_plan: e164, carrier_code: D201001010001.1, locked: false
	Then add header X-FreeTDM-CPC: ordinary
	Then add header X-FreeTDM-Presentation: 0
	Then add header X-FreeTDM-Screen: 3
	Then add header X-FreeTDM-CLG-NADI: 3
	Then add header X-FreeTDM-GN-NumQual: 6
	Then add header X-FreeTDM-GN: 000000000
	Then add header X-FreeTDM-GN-NADI: 3
	Then add header X-FreeTDM-GN-Screen: 0
	Then add header X-FreeTDM-GN-Presentation: 0
	Then add header X-FreeTDM-GN-Plan: 1
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/000000000/000000000/ALLOWED/Jean Bon -- e/0990000000002/123456789
	Then dial channel SIP/NSG with nadi 3, number 123456789-g=ORT and options 121
  Given release cause 20
	Then hangup with cause 38
  Given answered time 0
  Then complete cdr <any> 500/Error 0
	Then done

