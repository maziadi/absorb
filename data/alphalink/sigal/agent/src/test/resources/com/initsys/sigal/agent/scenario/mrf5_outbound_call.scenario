Scenario: nominal, e164/e164
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then set callerId to +33000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789 
	Then done

Scenario: nominal, e164/e164, sans + dans le callingNumber
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
  Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net   
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then set callerId to +33000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
	Then done

Scenario: nominal, national 
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
  Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net   
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: national, in_plan: national, trunk: true
	Then set callerId to 0000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/0000000000/0000000001/ALLOWED/Jean Bon -- e/0990000000002/0123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 0123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/0000000000/0000000001/ALLOWED/Jean Bon -- e/0990000000002/0123456789
	Then done

Scenario: nominal, national/e164 
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
  Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net   
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: national, in_plan: e164, trunk: true
	Then set callerId to 0000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/0000000000/0000000001/ALLOWED/Jean Bon -- e/0990000000002/0123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 0123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/0000000000/0000000001/ALLOWED/Jean Bon -- e/0990000000002/0123456789
	Then done

Scenario: nominal, e164/e164, non trunk
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
  Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net   
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: no
	Then set callerId to +33000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw/0990000000002 with number , timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
	Then done

Scenario: nominal, e164/e164, non reponse, sans voicemail
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then set callerId to +33000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/33123456789 
	Then done

Scenario: nominal, e164/e164plus
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164plus, in_plan: e164, trunk: true
	Then set callerId to +33000000000 and Jean Bon
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/+33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number +33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33000000000/+33000000001/ALLOWED/Jean Bon -- e/0990000000002/+33123456789 
	Then done

Scenario: e164/e164 privacy with anonymous
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Anonymous <anonymous> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: id
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then add header Privacy: id
	Then set callerId to anonymous and Anonymous
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789 
	Then done

Scenario: e164/e164 privacy
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: id
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then add header Privacy: id
	Then set callerId to anonymous and Anonymous
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789 
	Then done

Scenario: e164/e164 privacy with anonymous
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Anonymous <anonymous> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: id
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then add header Privacy: id
	Then set callerId to anonymous and Anonymous
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/+33000000001/RESTRICTED/Anonymous -- e/0990000000002/33123456789 
	Then done

Scenario: e164/national privacy
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from Jean Bon <+33000000000> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: id
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: national, in_plan: e164, trunk: true
	Then add header Privacy: id
	Then set callerId to anonymous and Anonymous
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/anonymous/0000000001/RESTRICTED/Anonymous -- e/0990000000002/0123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 0123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/anonymous/0000000001/RESTRICTED/Anonymous -- e/0990000000002/0123456789 
	Then done

Scenario: e164/e164 with wrong calling name
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from 0987654 <+33111111111> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: e164, in_plan: e164, trunk: true
	Then set callerId to +33111111111 and +33111111111
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/+33111111111/+33000000001/ALLOWED/+33111111111 -- e/0990000000002/33123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 33123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/+33111111111/+33000000001/ALLOWED/+33111111111 -- e/0990000000002/33123456789 
	Then done

Scenario: e164/national with wrong calling name
	Given mrf5.Mrf5OutboundAgi and outbound_timeout: 122, gw_channel_name: SIP/gw
	Given a call from 13456789 <+33111111111> to 33123456789 within D201001010001.1
	Given header P-Asserted-Identity: <tel:+33000000001>
	Given header Privacy: <null>
	Given account code <null>
	Given header X-AccountCode: 0991000001017
	Given SIP DOMAIN 0990000000002.mrf-10.sip.openvno.net
	Given icid abcdef1234567890
	Then query LIDB with 33123456789 and return account_code: 0990000000002, out_plan: national, in_plan: e164, trunk: true
	Then set callerId to 0111111111 and 0111111111
	Then add header X-AccountCode: 0990000000002
	Then cdr abcdef1234567890/D201001010001.1 - i/0991000001017/0111111111/0000000001/ALLOWED/0111111111 -- e/0990000000002/0123456789
  Then set P-Charging-Vector
	Then dial channel SIP/gw with number 0123456789, timeout 122 and separator ,
  Given release cause 16
  Then hangup with cause 16
  Given answered time 1234
	Then complete cdr abcdef1234567890/200_Answered/1234/D201001010001.1 - i/0991000001017/0111111111/0000000001/ALLOWED/0111111111 -- e/0990000000002/0123456789 
	Then done

