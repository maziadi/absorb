<?xml version="1.0"?>
<?castor class-name="org.opennms.netmgt.poller.PollerConfiguration"?>

<!-- serviceUnresponsiveEnabled: - si le service ne reponde pas en periode timeout; OpenNMS va verifier de nouveau le service dans 30secondes -->
<!--                             - service outage n'est pas genere seulement un event "unresponsive service"                                  -->
<!-- node-outage status=on     : - les events "InterfaceDown" et "NodeLostService" sont remplace par event "NodeDown"                         -->
<!-- critical-service          : - le service qui va etre verifie apres event "NodeNown"                                                      -->
<!--                             - une fois critical-service sera en service, des autres services vont etre verifies                          -->
<!--                             - si la service est definie (exemple ICMP), la perdition de ce service est considere comme nodeDown; autres  -->
<!--                               services sont consideres comme down (meme si en realite elle fonctionnent)                                 -->
<!-- pollAllIfNoCriticalServiceDefined: - "true"  Il faut que tout les services soienet down pour faire un event NodeDown                     -->
<!--                                    - "false" Il suffit que le service critique soit down, un event NodeDown est cree                     -->


<poller-configuration threads="30" serviceUnresponsiveEnabled="false"> 
  <node-outage status="on" pollAllIfNoCriticalServiceDefined="true">
    <critical-service name=""/>
  </node-outage>

  <!-- =====================================================  default ================================================================ -->
  <package name="default">
    <filter>IPADDR != '0.0.0.0'</filter>
    <include-range begin="0.0.0.0" end="255.255.255.255" />
    <rrd step="300">
      <rra>RRA:AVERAGE:0.5:1:2016</rra>
      <rra>RRA:AVERAGE:0.5:12:1488</rra>
      <rra>RRA:AVERAGE:0.5:288:366</rra>
      <rra>RRA:MAX:0.5:288:366</rra>
      <rra>RRA:MIN:0.5:288:366</rra>
    </rrd>

    <!-- ================== ICMP (Ping) ================ -->
    <service name="ICMP" interval="300000"  user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="icmp"                          />
      <parameter key="ds-name"              value="icmp"                          />
    </service>
    <!-- ==================== SNMP ===================== -->
    <service name="SNMP" interval="300000"  user-defined="false" status="off">
      <parameter key="retry"                value="2"                             />
      <parameter key="timeout"              value="3000"                          />
      <parameter key="port"                 value="161"                           />
      <parameter key="oid"                  value=".1.3.6.1.2.1.1.2.0"            />
    </service>
    <!-- ===================== SSH ===================== -->
      <service name="SSH" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22"                            />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh"                           />
      <parameter key="ds-name"              value="ssh"                           /> 
    </service> 

     <service name="SSH-22000" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22000"                         />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh-22000"                     />
      <parameter key="ds-name"              value="ssh-22000"                     /> 
    </service> 

    <service name="SSH-22001" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22001"                         />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh-22001"                     />
      <parameter key="ds-name"              value="ssh-22001"                     /> 
    </service> 

    <service name="SSH-22002" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22002"                         />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh-22002"                     />
      <parameter key="ds-name"              value="ssh-22002"                     /> 
    </service> 

    <service name="SSH-22003" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22003"                         />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh-22003"                     />
      <parameter key="ds-name"              value="ssh-22003"                     /> 
    </service> 

    <service name="SSH-22004" interval="300000"   user-defined="false" status="on">
      <parameter key="retry"                value="2"                             />
      <parameter key="banner"               value="SSH"                           />
      <parameter key="port"                 value="22004"                         />
      <parameter key="timeout"              value="10000"                         />
      <parameter key="rrd-repository"       value="/var/lib/opennms/rrd/response" />
      <parameter key="rrd-base-name"        value="ssh-22004"                     />
      <parameter key="ds-name"              value="ssh-22004"                     /> 
    </service> 

    <service name="AdaptecRAID" interval="300000" user-defined="false" status="on">
      <parameter key="retry"                value="2"                                />
      <parameter key="timeout"              value="3000"                             />
      <parameter key="port"                 value="161"                              />
      <parameter key="oid"                  value=".1.3.6.1.4.1.795.14.1.400.1.1.11" />
      <parameter key="operator"             value="="                                />
      <parameter key="operand"              value="3"                                />
      <parameter key="walk"                 value="true"                             />
    </service>

    <!-- (30sec; 0sec; 30sec): A partir d une detection hors service, verification (pooling) tout les 30 sec pendant 5 min -->
    <downtime interval="30000" begin="0" end="300000" />

    <!-- (5min; 5min; 12h):    A partir 5min apres une detection hors service, verification (pooling) tout les 5min pendant 12 heures (43200000ms -->
    <downtime interval="300000" begin="300000" end="43200000" />  

    <!-- (10min; 12h; 5j):     A partir 12h aprs une detection du hors service, verification (pooling) tout les 10min pendant 5 jours (432000000ms) -->
    <!-- (10min; 12h;   )      Pour pooling du service pour toujours, enlevez le parametre end=... dans la ligne suivante -->
    <downtime interval="600000" begin="43200000" end="432000000" />

    <!-- (30min; 5j;   ):     A partir 5 jours (432000000 ms) verification tout les 30min pour toujours -->
    <downtime interval="1800000" begin="43200000" />
    <!-- (5jours) Apres 5 jours, le service ne sera plus verifie (pooling); les service vont recevoir l etiquette "forced unmanaged" dans la base de donne de OpenNMS -->
    <!-- si vouz souhaitez verifier (pooler) une service pour toujours; effacez la ligne suivante et enlevez le parametre "end=..." dans la ligne precedente -->
    <!--<downtime begin="432000000" delete="true" />-->
  </package>

  <!-- =================================== Class definitions pour monitorer des services ============================================= -->
  <monitor service="ICMP"                   class-name="org.opennms.netmgt.poller.monitors.IcmpMonitor" />
  <monitor service="StrafePing"             class-name="org.opennms.netmgt.poller.monitors.StrafePingMonitor" />
  <monitor service="HTTP"                   class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" />
  <monitor service="HTTP-8080"              class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" />
  <monitor service="HTTP-8000"              class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" />
  <monitor service="HTTPS"                  class-name="org.opennms.netmgt.poller.monitors.HttpsMonitor" />
  <monitor service="HypericAgent"           class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" />
  <monitor service="HypericHQ"              class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor" />
  <monitor service="SMTP"                   class-name="org.opennms.netmgt.poller.monitors.SmtpMonitor" />
  <monitor service="DHCP"                   class-name="org.opennms.netmgt.poller.monitors.DhcpMonitor" />
  <monitor service="DNS"                    class-name="org.opennms.netmgt.poller.monitors.DnsMonitor" />
  <monitor service="FTP"                    class-name="org.opennms.netmgt.poller.monitors.FtpMonitor" />
  <monitor service="SNMP"                   class-name="org.opennms.netmgt.poller.monitors.SnmpMonitor" />
  <monitor service="AdaptecRAID"            class-name="org.opennms.netmgt.poller.monitors.SnmpMonitor" />
  <monitor service="Oracle"                 class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" />
  <monitor service="Postgres"               class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" />
  <monitor service="MySQL"                  class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" />
  <monitor service="SQLServer"              class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" />
  <monitor service="SSH"                    class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="SSH-22000"              class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="SSH-22001"              class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="SSH-22002"              class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="SSH-22003"              class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="SSH-22004"              class-name="org.opennms.netmgt.poller.monitors.SshMonitor" />
  <monitor service="IMAP"                   class-name="org.opennms.netmgt.poller.monitors.ImapMonitor" />
  <monitor service="POP3"                   class-name="org.opennms.netmgt.poller.monitors.Pop3Monitor" />
  <monitor service="NSClient"               class-name="org.opennms.netmgt.poller.monitors.NsclientMonitor" />
  <monitor service="NRPE"                   class-name="org.opennms.netmgt.poller.monitors.NrpeMonitor" />
  <monitor service="NRPE-NoSSL"             class-name="org.opennms.netmgt.poller.monitors.NrpeMonitor" />
  <monitor service="NSClientpp"             class-name="org.opennms.netmgt.poller.monitors.NsclientMonitor" />
  <monitor service="Windows-Task-Scheduler" class-name="org.opennms.netmgt.poller.monitors.Win32ServiceMonitor" />
</poller-configuration>
