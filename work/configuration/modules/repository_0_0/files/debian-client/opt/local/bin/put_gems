#!/usr/bin/env ruby



def sh(cmd)
  puts cmd
  system cmd
end

if ARGV.size != 2
  puts "Usage : put_gems [repository] [file]"
  exit -1
end

server = ARGV[0]
file = ARGV[1] 
dir = "/data/packages/gems"

if not(file =~ /.*\.gem/)
  puts "you can only put gem"
  exit -1
end

sh "scp #{file} #{server}:#{dir}/gems"
sh "ssh #{server} \"chmod o+r #{dir}/gems/*\""
sh "ssh #{server} \"gem generate_index -d #{dir}\""
