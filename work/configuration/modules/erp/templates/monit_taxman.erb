<% %w(q1 q2).each do |q| %>
<% consumer_number.to_i.times do |cons_num| %>
check process taxer_<%= q %>_<%= cons_num %>
  with pidfile "/var/run/taxman/taxer_<%= q %>_<%= cons_num %>.pid"
  start program = "/bin/su - taxman -c 'RAILS_ENV=<%= taxman_env %> script/taxer start --queue <%= q %> --instance <%= cons_num %>'"
  stop program = "/bin/su - taxman -c 'RAILS_ENV=<%= taxman_env %> script/taxer stop --queue <%= q %> --instance <%= cons_num %>'"
  group taxer
<% end %>
<% end %>

check device mongofs with path /var/lib/mongodb
    alert <%= monit_conf_alert_email %> 
    if space usage > 45% for 5 times within 15 cycles then alert
    if inode usage > 60% for 5 times within 15 cycles then alert 
check device datafs with path /data
    alert <%= monit_conf_alert_email %> 
    if space usage > 80% for 5 times within 15 cycles then alert
    if inode usage > 90% for 5 times within 15 cycles then alert 

<% if webserver_taxman %>
check process nginx
  with pidfile "/var/run/nginx.pid"
  alert <%= monit_conf_alert_email %>
<% end %>
